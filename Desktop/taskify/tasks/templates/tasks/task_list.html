{% extends 'tasks/base.html' %}
{% block content %}
<h2 class="mb-3">Your Tasks</h2>

<div class="d-flex justify-content-between align-items-center mb-3">
  <!-- üîç Search bar -->
  <form method="get" class="d-flex gap-2 w-50">
    <input
      type="text"
      name="q"
      value="{{ search_query }}"
      placeholder="Search tasks..."
      class="form-control"
    />
    <button type="submit" class="btn btn-outline-secondary">Search</button>
  </form>

  <!-- ‚ûï Add button -->
  <a href="{% url 'add_task' %}" class="btn btn-primary">+ Add Task</a>
</div>

<!-- Filters + Sorting -->
<form method="get" class="d-flex gap-2 mb-3">
  <select name="filter" class="form-select">
    <option value="all" {% if filter_status == 'all' %}selected{% endif %}>All</option>
    <option value="completed" {% if filter_status == 'completed' %}selected{% endif %}>Completed</option>
    <option value="pending" {% if filter_status == 'pending' %}selected{% endif %}>Pending</option>
  </select>

  <select name="sort" class="form-select">
    <option value="due_date" {% if sort_option == 'due_date' %}selected{% endif %}>Sort by Due Date</option>
    <option value="title" {% if sort_option == 'title' %}selected{% endif %}>Sort by Title</option>
  </select>

  <button type="submit" class="btn btn-outline-secondary">Apply</button>
</form>

</div>

<table class="table table-bordered bg-white">
  <thead>
    <tr>
      <th>Title</th>
      <th>Due Date</th>
      <th>Completed</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for task in page_obj %}
      <tr>
        <td>{{ task.title }}</td>
        <td>{{ task.due_date }}</td>
        <td>{{ task.is_completed|yesno:"‚úÖ,‚ùå" }}</td>
       <td>
  		<a href="{% url 'edit_task' task.pk %}" class="btn btn-sm btn-warning">Edit</a>
  		<a href="{% url 'delete_task' task.pk %}" class="btn btn-sm btn-danger">Delete</a>
  		{% if task.is_completed %}
  		  <a href="{% url 'toggle_task_completion' task.pk %}" class="btn btn-sm btn-secondary">Mark as Incomplete</a>
  		{% else %}
  		  <a href="{% url 'toggle_task_completion' task.pk %}" class="btn btn-sm btn-success">Mark as Completed</a>
  		{% endif %}
		</td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="4" class="text-center">No tasks found.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Pagination -->
<nav>
  <ul class="pagination justify-content-center">
    {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&filter={{ filter_status }}&sort={{ sort_option }}">Previous</a></li>
    {% endif %}

    <li class="page-item disabled">
      <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    </li>

    {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&filter={{ filter_status }}&sort={{ sort_option }}">Next</a></li>
    {% endif %}
  </ul>
</nav>
{% endblock %}
